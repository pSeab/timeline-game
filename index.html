<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timeline Ultimate Online</title>

<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">

<style>
body{
margin:0;
font-family:'Prompt',sans-serif;
background:linear-gradient(135deg,#e0f2fe,#fce7f3);
}
.container{
max-width:1000px;
margin:auto;
padding:20px;
}
.glass{
background:rgba(255,255,255,0.6);
backdrop-filter:blur(20px);
border-radius:25px;
padding:20px;
margin-bottom:20px;
box-shadow:0 20px 40px rgba(0,0,0,0.1);
}
.card{
background:white;
padding:15px;
border-radius:18px;
box-shadow:0 8px 20px rgba(0,0,0,0.08);
cursor:grab;
}
.timeline{
display:flex;
gap:10px;
overflow-x:auto;
padding:10px 0;
}
.player{
background:white;
padding:8px 15px;
border-radius:15px;
margin:5px;
}
button{
padding:10px 15px;
border:none;
border-radius:12px;
background:#6366f1;
color:white;
cursor:pointer;
}
input{
padding:8px;
border-radius:10px;
border:1px solid #ccc;
}
</style>
</head>
<body>

<div class="container">

<div id="lobby" class="glass">
<h2>üé≤ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</h2>
<input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
<input id="room" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á">
<button onclick="joinRoom()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</button>
</div>

<div id="game" style="display:none;">

<div class="glass">
<h2>‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
<div id="currentCard" class="card" draggable="true"></div>
</div>

<div class="glass">
<h2>Timeline</h2>
<div id="timeline" class="timeline"></div>
</div>

<div class="glass">
<h2>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
<div id="scores"></div>
</div>

</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

/* üî• ‡πÉ‡∏™‡πà firebaseConfig ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì */
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_ID",
  storageBucket: "",
  messagingSenderId: "",
  appId: ""
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let events=[]
let timeline=[]
let playerName
let roomId
let currentPlayer=0

async function loadEvents(){
const res=await fetch("events.json")
events=await res.json()
}

function randomEvent(){
return events[Math.floor(Math.random()*events.length)]
}

window.joinRoom=async function(){
playerName=document.getElementById("name").value
roomId=document.getElementById("room").value

document.getElementById("lobby").style.display="none"
document.getElementById("game").style.display="block"

set(ref(db,'rooms/'+roomId+'/players/'+playerName),{score:0})

loadEvents()
drawCard()
syncRoom()
}

function drawCard(){
let e=randomEvent()
let card=document.getElementById("currentCard")
card.innerHTML=e.title
card.dataset.year=e.year
}

function syncRoom(){
onValue(ref(db,'rooms/'+roomId),(snapshot)=>{
let data=snapshot.val()
if(data?.timeline){
timeline=data.timeline
renderTimeline()
}
if(data?.players){
renderScores(data.players)
}
})
}

function renderTimeline(){
let container=document.getElementById("timeline")
container.innerHTML=""
timeline.sort((a,b)=>a.year-b.year)
timeline.forEach(e=>{
container.innerHTML+=`<div class="card">${e.title}<br><b>${e.year}</b></div>`
})
}

function renderScores(players){
let s=document.getElementById("scores")
s.innerHTML=""
for(let p in players){
s.innerHTML+=`<div class="player">${p}: ${players[p].score}</div>`
}
}

document.getElementById("currentCard").addEventListener("dragstart",(e)=>{
e.dataTransfer.setData("text/plain",JSON.stringify({
title:e.target.innerText,
year:e.target.dataset.year
}))
})

document.getElementById("timeline").addEventListener("dragover",(e)=>{e.preventDefault()})

document.getElementById("timeline").addEventListener("drop",(e)=>{
e.preventDefault()
let data=JSON.parse(e.dataTransfer.getData("text/plain"))
timeline.push(data)
set(ref(db,'rooms/'+roomId+'/timeline'),timeline)
set(ref(db,'rooms/'+roomId+'/players/'+playerName+'/score'),
Math.floor(Math.random()*5)+1)
drawCard()
})

</script>

</body>
</html>
